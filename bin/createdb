#!/bin/bash

source .env

SUPER_VISOR_RESTART_REQUIRED=false

DB_NAME="$1"

#parse params
while [[ $# -gt 0 ]]
do
key="$1"


case $key in
     -s|--supervisor)
    SUPER_VISOR_RESTART_REQUIRED=true
    ;;
esac
shift
done


if [ -z ${DB_NAME+x} ]; then
	echo -e "${RED_COLOR}Please enter database name that you want to create${NO_COLOR}"
	exit
fi


if $SUPER_VISOR_RESTART_REQUIRED ; then
	(
		service supervisor stop
	) || (
		echo -e "${RED_COLOR}Can't stop supervisor${NO_COLOR}"
	)

fi

(
	mysql -u "$DB_USER" --password="$DB_PASSWORD" -e "create database $DB_NAME;" &&
    echo -e "${GREEN_COLOR}Database created${NO_COLOR}"
) || (
	echo -e "${RED_COLOR}Can't create database${NO_COLOR}"
)


if $SUPER_VISOR_RESTART_REQUIRED ; then
	(
		service supervisor start
	) || (
		echo -e "${RED_COLOR}Can't start supervisor${NO_COLOR}"
	)
fi